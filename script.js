const monsterList = {
"牛怪": 0,
"猎犬怪": 1,
"暗黑骑士": 10,
"Trap": 104,
"幽灵": 11,
"骷灵骑士3": 111,
"骷灵巫师3": 112,
"假面武士4": 113,
"假面弓手4": 114,
"骷灵战士4": 115,
"骷灵兽4": 116,
"骷灵骑士4": 117,
"骷灵巫师4": 118,
"假面武士5": 119,
"毒虫": 12,
"假面弓手5": 120,
"骷灵战士5": 121,
"骷灵兽5": 122,
"骷灵骑士5": 123,
"骷灵巫师5": 124,
"假面武士6": 125,
"假面弓手6": 126,
"骷灵战士6": 127,
"骷灵兽6": 128,
"骷灵骑士6": 129,
"地狱蜘蛛": 13,
"骷灵巫师6": 130,
"血色城门": 131,
"血色城门": 131,
"水晶灵柩": 132,
"水晶灵柩": 132,
"水晶灵柩": 133,
"水晶灵柩": 133,
"水晶灵柩": 134,
"水晶灵柩": 134,
"白色魔法师": 135,
"毁灭武士": 136,
"毁灭弓手": 137,
"假面武士7": 138,
"假面弓手7": 139,
"骷髅兵": 14,
"骷灵战士7": 140,
"骷灵兽7": 141,
"骷灵骑士7": 142,
"骷灵巫师7": 143,
"死亡天使": 144,
"狂武士": 145,
"龙虾守卫": 146,
"阿卡斯": 147,
"武士": 148,
"暗黑巫师": 149,
"骷髅弓箭手": 15,
"守护兽巴里": 150,
"黄金斗士": 151,
"骷髅战士": 16,
"暗黑傀儡": 160,
"昆顿": 161,
"赤色要塞1": 162,
"赤色要塞1": 163,
"赤色要塞2": 164,
"赤色要塞2": 165,
"赤色要塞3": 166,
"赤色要塞3": 167,
"赤色要塞4": 168,
"赤色要塞4": 169,
"独眼巨人": 17,
"赤色要塞5": 170,
"赤色要塞5": 171,
"赤色要塞6": 172,
"赤色要塞6": 173,
"死亡天使": 174,
"狂武士": 175,
"龙虾守卫": 176,
"阿卡斯": 177,
"武士": 178,
"暗黑巫师": 179,
"魔鬼戈登": 18,
"暗黑傀儡": 180,
"昆顿": 181,
"死亡天使": 182,
"狂武士": 183,
"龙虾守卫": 184,
"阿卡斯": 185,
"武士": 186,
"暗黑巫师": 187,
"暗黑傀儡": 188,
"昆顿": 189,
"雪人": 19,
"死亡天使": 190,
"狂武士": 191,
"龙虾守卫": 192,
"阿卡斯": 193,
"武士": 194,
"暗黑巫师": 195,
"暗黑傀儡": 196,
"昆顿": 197,
"幼龙": 2,
"雪人王": 20,
"战狼神座": 204,
"神狼护台1": 205,
"神狼护台2": 206,
"神狼护台3": 207,
"神狼护台4": 208,
"神狼护台5": 209,
"暗杀者": 21,
"保护膜": 215,
"皇冠": 216,
"皇冠开关1": 217,
"皇冠开关2": 218,
"城门开关": 219,
"寒冰魔": 22,
"门卫": 220,
"攻击投石车": 221,
"攻击投石车": 222,
"长老": 223,
"攻城卫兵": 224,
"驯兽师": 226,
"警卫队长摩伦": 229,
"蓝魔怪": 23,
"阿莱斯": 230,
"商人托姆绅": 231,
"大天使": 232,
"大天使的使者": 233,
"巩瘤扁 绊喉赴": 234,
"圣导士塞维娜": 235,
"弓箭手洛斯": 236,
"卡隆": 237,
"玛雅哥布林": 238,
"竞技场守卫": 239,
"雪虫": 24,
"仓库使者": 240,
"战盟使者": 241,
"精灵安吉拉": 242,
"工匠尤达": 243,
"老板娘莉娜": 244,
"魔导士露茜": 245,
"武器商人苏菲": 246,
"守卫": 247,
"流浪商人": 248,
"守卫": 249,
"冰后": 25,
"流浪商人": 250,
"铁匠 汉斯": 251,
"未知怪物--": 252,
"少女安娜": 253,
"魔导士 帕希": 254,
"老板娘 莉雅": 255,
"塞尔维斯": 256,
"塞尔维斯": 256,
"幻影导师": 257,
"幻影导师": 257,
"鲁克导师": 258,
"雷拉": 259,
"小哥布林": 26,
"死亡天使": 260,
"狂武士": 261,
"龙虾守卫": 262,
"阿卡斯": 263,
"武士": 264,
"暗黑巫师": 265,
"暗黑傀儡": 266,
"昆顿": 267,
"死亡天使": 268,
"狂武士": 269,
"勾尾蝎": 27,
"龙虾守卫": 270,
"阿卡斯": 271,
"武士": 272,
"暗黑巫师": 273,
"暗黑傀儡": 274,
"魔王昆顿": 275,
"城门1": 277,
"复活石": 278,
"瓢虫怪": 28,
"守护石像": 283,
"冠": 284,
"咖迪恩": 285,
"弓箭佣兵": 286,
"标枪佣兵": 287,
"神堡": 288,
"偷猎者": 29,
"冷血变异者": 290,
"熔岩巨魔": 291,
"嗜血蜂后": 292,
"毒巨魔": 293,
"巨斧战士": 294,
"炼狱魔王": 295,
"怪物7": 296,
"诅咒战士": 297,
"XXX": 297,
"蜘蛛": 3,
"树妖": 30,
"英雄铁脊怪": 300,
"英雄恶灵王": 301,
"英雄巨斧战士": 302,
"英雄毒巨魔": 303,
"丛林女巫师": 304,
"丛林生命体": 305,
"丛林暗杀者": 306,
"丛林残暴者": 307,
"丛林树精灵": 308,
"丛林召唤者": 309,
"亚昆": 31,
"刺锤侦察兵": 310,
"长矛侦察兵": 311,
"魔弓侦察兵": 312,
"暗黑血狼人": 313,
"英雄侦察兵": 314,
"英雄血狼人": 315,
"暗黑防御者": 316,
"暗黑扫荡者": 317,
"石巨人": 32,
"大哥布林": 33,
"阿卡斯": 331,
"武士": 332,
"龙虾守卫": 333,
"死亡天使": 334,
"暗黑巫师": 335,
"狂武士": 336,
"暗黑傀儡": 337,
"昆顿": 338,
"诅咒巫师": 34,
"暗黑指挥官": 340,
"暗黑扫荡者": 341,
"暗黑防御者": 344,
"暗黑咒术师": 345,
"巨弩发射器": 348,
"巴卡斯司令官": 349,
"死神戈登": 35,
"疯魔": 350,
"裂角狼": 351,
"金甲兽": 352,
"半兽人": 353,
"刀刃猎手": 354,
"寒冰刺客": 355,
"狂巨人": 356,
"屠杀者": 357,
"假面巫": 358,
"毒步妖": 359,
"鬼魅": 36,
"恐惧天使": 360,
"咒怨魔王": 361,
"玛雅副手": 362,
"玛雅(左)右手": 363,
"玛雅生命体": 364,
"祝福囊": 365,
"传送台": 367,
"艾尔菲丝": 368,
"奥斯本": 369,
"恶魔": 37,
"杰瑞敦": 370,
"雷奥导师": 371,
"艾利特骷髅勇士": 372,
"杰克登": 373,
"圣诞老人": 374,
"玛雅使者": 375,
"物资管理员 帕糜拉": 376,
"物资管理员 安吉拉": 377,
"GameMaster": 378,
"爆竹商人 罗嗒莎": 379,
"魔王巴洛克": 38,
"石像": 380,
"奇迹联军队长": 381,
"幻影教团长老": 382,
"奇迹联军圣物保管盒": 383,
"幻影教团圣物保管盒": 384,
"弥拉丘": 385,
"幻影教亡灵": 386,
"幻影教亡灵": 387,
"幻影教亡灵": 388,
"幻影教亡灵": 389,
"剧毒鬼魅": 39,
"幻影教亡灵": 390,
"幻影教亡灵": 391,
"幻影教亡灵": 392,
"幻影教亡灵": 393,
"幻影教亡灵": 394,
"幻影教亡灵": 395,
"幻影教亡灵": 396,
"幻影教亡灵": 397,
"幻影教亡灵": 398,
"幻影教亡灵": 399,
"蛮牛怪": 4,
"死神骑士": 40,
"幻影教亡灵": 400,
"幻影教亡灵": 401,
"幻影教亡灵": 402,
"幻影教亡灵": 403,
"奇迹联军": 404,
"幻影教团": 405,
"弟子黛彬": 406,
"暗黑血狼人扩雷": 407,
"休息处守卫": 408,
"暗黑防御者(训练兵)": 409,
"牛魔王": 41,
"暗黑咒术师(训练兵)": 410,
"暗黑扫荡者(训练兵)": 411,
"暗黑指挥官(训练兵)": 412,
"月兔": 413,
"艾伦导师": 414,
"塞尔维亚": 415,
"雷亚": 416,
"摩尔塞": 417,
"怪异的兔子": 418,
"疯狂的兔子": 419,
"狼人": 420,
"污染之蝶": 421,
"诅咒巫师": 422,
"图腾树人": 423,
"灰熊": 424,
"残暴的灰熊": 425,
"赤色要塞7": 426,
"赤色要塞7": 427,
"半兽人队长": 428,
"半兽人弓箭手": 429,
"黄金幼龙": 43,
"黑骷髅战士": 430,
"巨灵欧古": 431,
"赤骷髅骑士": 432,
"骷髅法师": 433,
"狂巨人": 434,
"疯魔": 435,
"暗黑防御者(训练兵)": 436,
"暗黑扫荡者(训练兵)": 437,
"假面巫": 438,
"恐惧天使": 439,
"火龙王": 44,
"暗黑指挥官": 440,
"树妖": 441,
"毒树妖": 442,
"残忍的树妖": 443,
"暗影爪牙": 444,
"暗影骑士": 445,
"暗影武士": 446,
"闪电巨人": 447,
"幽灵巨人": 448,
"火焰巨人": 449,
"小巴哈姆特": 45,
"樱花精灵": 450,
"樱花树": 451,
"荧之石管理员": 452,
"荧之石研究员": 453,
"冰之魔犬": 454,
"冰之魔象": 455,
"冰之巨魔": 456,
"冰之魔蛛": 457,
"冰铁剑魂": 458,
"冰霜巨蛛": 459,
"死亡美人鱼": 46,
"巨蛛蛋": 460,
"巨蛛蛋": 461,
"巨蛛蛋": 462,
"火花幽灵": 463,
"初行者导师": 464,
"圣诞老人": 465,
"诅咒的哥布林": 466,
"雪人": 467,
"假扮的圣诞老人1": 468,
"假扮的圣诞老人2": 469,
"蓝翼海怪": 47,
"假扮的圣诞老人3": 470,
"假扮的圣诞老人4": 471,
"假扮的圣诞老人5": 472,
"假扮的圣诞老人6": 473,
"假扮的圣诞老人7": 474,
"假扮的圣诞老人8": 475,
"诅咒的圣诞老人": 476,
"变身雪人": 477,
"德嘉多": 478,
"门卫泰徒斯": 479,
"巫师王": 48,
"幽灵斗士": 480,
"幽灵斗士": 481,
"幽灵角斗士": 482,
"幽灵角斗士": 483,
"幽灵屠杀者": 484,
"幽灵屠杀者": 485,
"幽灵暗杀者": 486,
"幽灵残酷暗杀者": 487,
"幽灵残酷暗杀者": 488,
"幽灵巨人": 489,
"海魔希特拉": 49,
"幽灵残酷巨人": 490,
"幽灵残酷巨人": 491,
"摩斯": 492,
"黄金暗黑骑士": 493,
"黄金恶魔": 494,
"黄金石巨人": 495,
"黄金恶灵": 496,
"黄金半兽人": 497,
"黄金独步妖": 498,
"黄金铁轮战士": 499,
"地狱猎犬怪": 5,
"海虫": 50,
"黄金巨人": 500,
"黄金巨龙": 501,
"黄金兔子": 502,
"帝国司令凯文": 504,
"凯文的辅佐官": 505,
"帝国副司令": 506,
"帝国指挥官": 507,
"帝国第一军团长": 508,
"帝国第二军团长": 509,
"大巴哈姆特": 51,
"帝国第三军团长": 510,
"帝国第四军团长": 511,
"帝国校尉": 512,
"帝国教官": 513,
"帝国骑士团长": 514,
"帝国大魔法师": 515,
"帝国暗杀团长": 516,
"帝国骑兵团长": 517,
"帝国刀盾兵": 518,
"帝国祭司": 519,
"银弓海怪": 52,
"帝国骑士": 520,
"帝国护卫": 521,
"辅佐官 杰林特": 522,
"陷阱": 523,
"城门1": 524,
"城门2": 525,
"石像1": 526,
"城门3": 527,
"城门4": 528,
"愤怒的屠夫": 529,
"泰坦": 53,
"屠夫": 530,
"冰之魔犬": 531,
"幼虫": 532,
"生魂": 533,
"生魂弓箭手": 534,
"生魂剑士": 535,
"生魂魔法师": 536,
"生魂魔剑士": 537,
"生魂圣导师": 538,
"生魂召唤术师": 539,
"黄金斗士": 54,
"陆迦德": 540,
"小奖励宝箱": 541,
"大奖励宝箱": 542,
"多普瑞恩家族管家": 543,
"巴内尔特家族管家": 544,
"杂货商人 克里斯丁": 545,
"宝石商人 罗尔": 546,
"市场传送师 朱丽亚": 547,
"变身骨架": 548,
"血腥兽人": 549,
"骷髅王": 55,
"血腥死亡骑士": 550,
"血腥魔头": 551,
"血腥大法": 552,
"狂暴战士": 553,
"半人马勇士": 554,
"时间勇士": 555,
"热那亚勇士": 556,
"冥树妖": 557,
"冥战士": 558,
"影法师": 559,
"强化骷髅兵": 56,
"魅影骑士": 560,
"美杜莎": 561,
"黑暗猛犸": 562,
"黑暗巨人": 563,
"黑暗蜘蛛": 564,
"黑暗骑士": 565,
"佣兵团管理员 泰西亚": 566,
"神女 贝娜": 567,
"流浪商人 扎亿鲁": 568,
"毒蝎子": 569,
"铁轮战士": 57,
"巨蟹子": 570,
"冥界斧手": 571,
"冥界四拳": 572,
"机甲蝎子": 573,
"变种蝎子": 574,
"库拉": 575,
"库拉王": 576,
"杂货商人 雷娜": 577,
"武器商人 波罗": 578,
"达比德": 579,
"破坏骑士": 58,
"魔王扎坎": 59,
"黑巫师": 6,
"巨齿兽": 60,
"双子佩里": 600,
"元素怪兽": 601,
"元素骑士": 602,
"远古双子佩里": 603,
"远古元素怪兽": 604,
"远古元素骑士": 605,
"水女神": 606,
"撒拉曼德": 607,
"仙女": 608,
"诺姆": 609,
"黑炎魔": 61,
"希拉斯": 610,
"水之塔": 611,
"火之塔": 612,
"风之塔": 613,
"土之塔": 614,
"暗之塔": 615,
"德班泰尔恶魔费尔里": 616,
"德班泰尔元素比斯特": 617,
"德班泰尔元素骑士": 618,
"努尔穆斯": 619,
"铁脊怪": 62,
"穆福": 620,
"乌尔克双子佩里": 621,
"乌尔克元素野兽": 622,
"乌尔克元素骑士": 623,
"纳尔斯恶魔佩里": 624,
"纳尔斯元素野兽": 625,
"纳尔斯元素骑士": 626,
"菲利亚弓手": 628,
"菲利亚格斗家": 629,
"炽炎魔": 63,
"菲利亚将军": 630,
"菲利亚水晶": 631,
"帕拉卡斯": 632,
"巴斯基": 633,
"贝丝": 634,
"尼斯湖水晶石": 635,
"枯树蛮牛怪": 637,
"枯树长者": 638,
"黑暗吞噬者": 639,
"假面弓手": 64,
"沼泽游荡者": 640,
"沼泽之怪兽": 641,
"沼泽水怪": 642,
"菲利亚骑士": 643,
"假面武士": 65,
"金属巴洛克": 66,
"诅咒之王": 67,
"阿卡摩斯": 69,
"巨人": 7,
"风后": 70,
"恶灵": 71,
"幻影骑士": 72,
"蓝魔龙": 73,
"恶灵王": 74,
"红魔龙": 75,
"天魔菲尼斯1": 76,
"天魔菲尼斯2": 77,
"黄金哥布林": 78,
"黄金火龙王": 79,
"毒牛怪": 8,
"黄金巫师王": 80,
"蓝领主": 800,
"蓝领主守护者": 801,
"绿领主": 802,
"绿领主守护者": 803,
"小绵羊": 804,
"鲜血魔王": 805,
"黑寡妇": 806,
"双头龙": 807,
"烈焰昆顿": 808,
"水晶矿工": 809,
"黄金美人鱼": 81,
"水晶车夫": 810,
"水晶运输工": 811,
"水晶挖掘工": 812,
"水晶工头": 813,
"水晶勘探者": 814,
"迷宫教官": 815,
"黄金破坏骑士": 82,
"黄金铁轮战士": 83,
"迷宫女巫": 830,
"迷宫长矛手": 831,
"阿努比萨斯": 832,
"辛维斯特": 833,
"马格里姆": 834,
"菲利亚君主": 835,
"尼克斯": 836,
"暗黑之王": 837,
"沼泽召唤者": 838,
"沼泽召唤者": 839,
"假面武士1": 84,
"假面弓手1": 85,
"骷灵战士1": 86,
"骷灵兽1": 87,
"骷灵骑士1": 88,
"白虎王": 880,
"虎王": 881,
"银狐": 882,
"鲁伯斯": 883,
"月光虎": 884,
"钢铁苍穹": 885,
"阎罗左护法": 886,
"阎罗右护法": 887,
"暗黑召唤者": 888,
"骷灵巫师1": 89,
"死灵巫師": 9,
"假面武士2": 90,
"假面弓手2": 91,
"骷灵战士2": 92,
"骷灵兽2": 93,
"骷灵骑士2": 94,
"骷灵巫师2": 95,
"假面武士3": 96,
"假面弓手3": 97,
"骷灵战士3": 98,
"骷灵兽3": 99,
    // 添加完整的怪物列表
};

function extractData() {
    const htmlContent = document.getElementById('htmlInput').value;
    const mapId = document.getElementById('mapId').value.trim() || '0';
    const moveDistance = document.getElementById('moveDistance').value.trim() || '20';
    const position = document.getElementById('position').value.trim() || '上方';
    const coordinateOffset = parseFloat(document.getElementById('coordinateOffset').value) || 10;
    const quantityMultiplier = parseFloat(document.getElementById('quantityMultiplier').value) || 1;

    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = htmlContent;

    const tableBody = document.querySelector('#resultTable tbody');
    tableBody.innerHTML = ''; // 清空表格

    const monsterRows = tempDiv.querySelectorAll('.monster_lia');

    if (monsterRows.length === 0) {
        alert("未找到任何怪物项，请检查HTML结构！");
        return;
    }

    monsterRows.forEach((monsterRow, index) => {
        try {
            console.group(`处理怪物项，索引: ${index}`);
            console.log("当前怪物项:", monsterRow);

            // 移除图片节点，避免加载错误
            const imageElem = monsterRow.querySelector('img');
            if (imageElem) {
                imageElem.remove(); // 从DOM中移除图片
                console.log("图片节点已移除");
            }

            // 获取怪物数量
            const monsterCountElem = monsterRow.querySelector('.text-warning');
            if (!monsterCountElem) {
                console.warn(`跳过怪物项，索引: ${index}（原因：缺少数量）`, monsterRow);
                console.groupEnd();
                return;
            }
            const monsterCountText = monsterCountElem.innerText.trim();
            const monsterCount = Math.round(parseInt(monsterCountText.split(':')[1]) * quantityMultiplier);

            // 获取怪物名称
            const monsterNameElem = monsterRow.closest('td').nextElementSibling.querySelector('.monster_liname a');
            const monsterName = monsterNameElem ? monsterNameElem.innerText.trim() : '未知名称';

            // 根据怪物名称从列表中查找怪物ID
            const monsterId = monsterList[monsterName] || '未知ID';

            // 查找包含 "坐标" 的 `td` 并获取其下一个兄弟节点中的内容
            let coordsElem = null;
            tempDiv.querySelectorAll('td').forEach(td => {
                if (td.textContent.trim() === "坐标") {
                    coordsElem = td.nextElementSibling; // 获取下一个兄弟节点
                }
            });

            const coordsText = coordsElem ? coordsElem.innerText.trim() : '0,0';
            const [coordX, coordY] = coordsText.split(',').map(v => parseFloat(v.trim()));

            // 计算偏移坐标
            const x1 = coordX - coordinateOffset;
            const y1 = coordY - coordinateOffset;
            const x2 = coordX + coordinateOffset;
            const y2 = coordY + coordinateOffset;

            // 生成刷怪方向
            const spawnDirection = position.replace(/位置/g, '方向');

            // 插入表格
            const row = tableBody.insertRow();
            row.insertCell(0).innerText = monsterId;
            row.insertCell(1).innerText = mapId;
            row.insertCell(2).innerText = moveDistance;
            row.insertCell(3).innerText = x1;
            row.insertCell(4).innerText = y1;
            row.insertCell(5).innerText = x2;
            row.insertCell(6).innerText = y2;
            row.insertCell(7).innerText = spawnDirection;
            row.insertCell(8).innerText = monsterCount;
            row.insertCell(9).innerText = `//${monsterName}`; // 添加怪物名称列

            console.groupEnd();
        } catch (error) {
            console.error(`处理怪物项时发生错误，索引: ${index}`, error, monsterRow);
        }
    });
}

function copyTableContent() {
    const tableBody = document.querySelector('#resultTable tbody');
    let content = "";

    // 遍历表格行，逐行提取内容
    Array.from(tableBody.rows).forEach(row => {
        const rowData = Array.from(row.cells).map(cell => cell.innerText).join("\t");
        content += rowData + "\n";
    });

    // 复制到剪贴板
    navigator.clipboard.writeText(content).catch(err => {
        console.error("复制失败: ", err);
    });
}

